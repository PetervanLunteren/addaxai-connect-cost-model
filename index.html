<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AddaxAI-Connect plan tool</title>
<link rel="icon" href="favicon.ico">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/cost.css">
<link rel="stylesheet" href="css/placement.css">
</head>
<body>

<header>
  <a href="https://github.com/PetervanLunteren/AddaxAI-Connect" target="_blank"><img src="logo.png" alt="AddaxAI"></a>
  <h1>AddaxAI-Connect plan tool</h1>
  <div class="header-actions">
    <button class="header-btn" id="btnSave">Save</button>
    <button class="header-btn" id="btnLoad">Load</button>
  </div>
  <input type="file" id="fileInput" accept=".json" style="display:none">
</header>

<div class="container">

  <!-- Tab bar -->
  <div class="tab-bar">
    <button class="tab-btn active" data-tab="tab-cost">Cost calculator</button>
    <button class="tab-btn" data-tab="tab-placement">Camera placement</button>
  </div>

  <!-- ============ COST TAB ============ -->
  <div class="tab-pane active" id="tab-cost">

    <!-- Parameters + Cost breakdown side by side -->
    <div class="grid main-grid">
      <div class="card">
        <div class="card-header green">Project parameters</div>
        <div class="card-body">
          <div class="input-row">
            <label>Number of years<span class="caption">Project duration, affects mobile data, software maintenance, server maintenance, and server instance costs</span></label>
            <select id="years"><option value="1">1 year</option><option value="2">2 years</option></select>
          </div>
          <div class="input-row checkbox-row">
            <label class="checkbox-label"><input type="checkbox" id="byo"> I'll bring my own cameras<span class="caption">Skips camera hardware costs, but usually requires a few days of software development to integrate with the platform</span></label>
          </div>
          <div class="input-row camera-row">
            <label>Active cameras<span class="caption">Cameras with an active connection to the system (includes SIM, SD-cards, batteries, configuration). See <a href="https://wiki.smartparks.org/addaxaiconnect/cameras/willfinet40cg" target="_blank">camera details</a></span></label>
            <input type="number" id="activeCameras" value="50" min="0" step="1">
          </div>
          <div class="input-row camera-row">
            <label>Backup cameras<span class="caption">Spare cameras without an active connection, no SIM or configuration costs</span></label>
            <input type="number" id="backupCameras" value="5" min="0" step="1">
          </div>
          <div class="input-row camera-row">
            <label>Enclosures<span class="caption">Optional protective camera housings</span></label>
            <input type="number" id="enclosures" value="0" min="0" step="1">
          </div>
          <div class="input-row checkbox-row">
            <label class="checkbox-label"><input type="checkbox" id="camMgmt"> Include camera placement and management<span class="caption">In the Netherlands handled by Wildlife Insight, in other countries this needs to be arranged separately</span></label>
          </div>
          <div class="input-row">
            <label>Training sessions<span class="caption">Onboarding sessions to walk through the platform, settings, and workflows</span></label>
            <input type="number" id="trainingSessions" value="1" min="0" step="1">
          </div>
          <div class="input-row">
            <label>Days of software development<span class="caption">Usually not needed, can be included for custom features or integrations</span></label>
            <input type="number" id="devDays" value="0" min="0" step="1">
          </div>
          <span class="prices-link" id="openModal">Configure unit prices</span>
        </div>
      </div>

      <div class="card">
        <div class="card-header dark">Cost breakdown</div>
        <div class="card-body" style="padding:0">
          <table class="output-table">
            <thead>
              <tr><th>Description</th><th>Basis</th><th>Unit price</th><th style="text-align:right">Quantity</th><th>Total</th></tr>
            </thead>
            <tbody id="outputBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Unit prices modal -->
    <div class="modal-overlay" id="pricesModal">
      <div class="modal">
        <div class="modal-header">
          Unit prices
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <table class="cost-table">
            <thead>
              <tr><th>Item</th><th>Price</th><th>Type</th></tr>
            </thead>
            <tbody>
              <tr><td>Camera</td><td><input type="number" class="modal-input" id="priceCamera" value="130" min="0" step="1"></td><td class="desc">per camera</td></tr>
              <tr><td>Enclosure</td><td><input type="number" class="modal-input" id="priceEnclosure" value="25" min="0" step="1"></td><td class="desc">per enclosure</td></tr>
              <tr><td>Configuration</td><td><input type="number" class="modal-input" id="priceConfig" value="25" min="0" step="1"></td><td class="desc">per camera</td></tr>
              <tr><td>Logistics</td><td><input type="number" class="modal-input" id="priceLogistics" value="10" min="0" step="1"></td><td class="desc">per camera</td></tr>
              <tr><td>SD-card (two sets)</td><td><input type="number" class="modal-input" id="priceSD" value="20" min="0" step="1"></td><td class="desc">per camera</td></tr>
              <tr><td>Batteries (two sets)</td><td><input type="number" class="modal-input" id="priceBatteries" value="100" min="0" step="1"></td><td class="desc">per camera</td></tr>
              <tr><td>Mobile data (SIM)*</td><td><input type="number" class="modal-input" id="priceSIM" value="5" min="0" step="0.5"></td><td class="desc">per camera / month</td></tr>
              <tr><td>Camera management**</td><td><input type="number" class="modal-input" id="camMgmtCost" value="300" min="0" step="10"></td><td class="desc">per camera / year</td></tr>
              <tr><td>Battery charger</td><td><input type="number" class="modal-input" id="priceCharger" value="50" min="0" step="1"></td><td class="desc">per project</td></tr>
              <tr><td>Software setup</td><td><input type="number" class="modal-input" id="priceSWSetup" value="1000" min="0" step="50"></td><td class="desc">per project</td></tr>
              <tr><td>Software maintenance</td><td><input type="number" class="modal-input" id="priceSWMaint" value="250" min="0" step="10"></td><td class="desc">per project / month</td></tr>
              <tr><td>Software development</td><td><input type="number" class="modal-input" id="priceSWDev" value="1000" min="0" step="50"></td><td class="desc">per day</td></tr>
              <tr><td>Server setup</td><td><input type="number" class="modal-input" id="priceSrvSetup" value="1000" min="0" step="50"></td><td class="desc">per project</td></tr>
              <tr><td>Server maintenance</td><td><input type="number" class="modal-input" id="priceSrvMaint" value="250" min="0" step="10"></td><td class="desc">per project / month</td></tr>
              <tr><td>Server instance</td><td><input type="number" class="modal-input" id="priceSrvInstance" value="100" min="0" step="10"></td><td class="desc">per project / month</td></tr>
              <tr><td>Training session</td><td><input type="number" class="modal-input" id="priceTraining" value="1000" min="0" step="50"></td><td class="desc">per session</td></tr>
            </tbody>
          </table>
          <p style="font-size:.7rem; color:#9ca3af; padding:.5rem .5rem 0; font-style:italic;">* Based on Dutch SIM cards, costs may vary by country.</p>
          <p style="font-size:.7rem; color:#9ca3af; padding:.25rem .5rem .25rem; font-style:italic;">** Wildlife Insight charges around 300 per camera per year. Only applies when enabled in project parameters.</p>
        </div>
      </div>
    </div>

    <!-- Scaling insight -->
    <details class="collapsible" id="scalingDetails">
      <summary class="collapsible-toggle">How does cost per camera per year change with scale?</summary>
      <div class="collapsible-body">
        <table class="output-table scaling-table">
          <tbody id="scalingBody"></tbody>
        </table>
        <div id="scalingChart" style="margin-top:1rem;"></div>
      </div>
    </details>

    <!-- Charts -->
    <div class="grid">
      <div class="card">
        <div class="card-header dark">Cost by category</div>
        <div class="chart-container">
          <svg id="catDonut" class="chart-svg" width="220" height="220" viewBox="0 0 220 220"></svg>
          <div id="catLegend" class="legend"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-header dark">Cost by item</div>
        <div class="chart-container">
          <svg id="donut" class="chart-svg" width="220" height="220" viewBox="0 0 220 220"></svg>
          <div id="legend" class="legend"></div>
        </div>
      </div>
    </div>

  </div>

  <!-- ============ PLACEMENT TAB ============ -->
  <div class="tab-pane" id="tab-placement">
    <div class="card">
      <div class="card-header green">Camera placement tool</div>
      <div class="placement-toolbar">
        <div class="input-row">
          <label>Cameras</label>
          <input type="number" id="placementCameras" value="50" min="1" step="1">
        </div>
      </div>
      <div class="map-wrap">
        <div id="map"></div>
        <div class="map-empty-state" id="mapEmptyState">
          <p>Draw a polygon on the map to define your study area.</p>
        </div>
        <div class="metrics-panel" id="metricsPanel">
          <h3>Study design metrics</h3>
          <div class="metric-line"><span class="metric-label">Study area</span><span class="metric-value" id="metricArea">-</span></div>
          <div class="metric-line"><span class="metric-label">Cameras placed</span><span class="metric-value" id="metricCameras">-</span></div>
          <div class="metric-line"><span class="metric-label">Camera density</span><span class="metric-value" id="metricDensity">-</span></div>
          <div class="metric-line"><span class="metric-label">Mean spacing</span><span class="metric-value" id="metricSpacing">-</span></div>
          <div class="metric-line"><span class="metric-label">Grid cell size</span><span class="metric-value" id="metricCellSize">-</span></div>
          <div class="metric-line"><span class="metric-label">Detection area</span><span class="metric-value" id="metricDetection">-</span></div>
          <div class="metric-line"><span class="metric-label">Coverage</span><span class="metric-value" id="metricCoverage">-</span></div>
        </div>
      </div>
    </div>
  </div>

</div>

<footer>
  <a href="https://github.com/PetervanLunteren/AddaxAI-Connect" target="_blank">AddaxAI-Connect</a> &mdash; Automated wildlife monitoring
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script src="https://unpkg.com/@turf/turf@7/turf.min.js"></script>
<script src="js/shared.js"></script>
<script src="js/cost.js"></script>
<script src="js/placement.js"></script>

</body>
</html>
